
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Binary collisions &#8212; Smilei b&#39;v4.3-106-g8c22fd7f\n&#39; documentation</title>
    <link rel="stylesheet" href="_static/smilei_theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script async="async" src="https://www.gitcdn.xyz/cdn/mathjax/MathJax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="_static/smileiIcon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Ionization" href="ionization.html" />
    <link rel="prev" title="Vectorization" href="vectorization.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    "HTML-CSS": {
      scale: 95,
      availableFonts: ["TeX"]
    }
  });
  </script>
   
  </head><body>

<div id="smallScreenMenu" class="off">

    
    <div class="toctree-smilei">
        <ul>
                <li class="outer">
                    <a href="licence.html">Licence</a>
                </li>
                <li class="outer">
                    <a href="synopsis.html">Synopsis</a>
                </li>
                <li class="outer">
                    <a href="highlights.html">Highlights</a>
                </li>
                <li class="outer">
                    <a href="releases.html">Releases</a>
                </li>
        </ul>
        <hr />
        <ul>
                <li class="outer">
                    <a href="units.html">Units</a>
                </li>
                <li class="outer">
                    <a href="algorithms.html">PIC algorithms</a>
                </li>
                <li class="outer">
                    <a href="parallelization.html">Parallelization basics</a>
                </li>
                <li class="outer">
                    <a href="vectorization.html">Vectorization</a>
                </li>
            </ul>
                <ul>
<li><a class="reference internal" href="#">Binary collisions</a><ul>
<li><a class="reference internal" href="#the-binary-collision-scheme">The binary collision scheme</a></li>
<li><a class="reference internal" href="#test-cases-for-collisions">Test cases for collisions</a></li>
<li><a class="reference internal" href="#collisional-ionization">Collisional ionization</a></li>
<li><a class="reference internal" href="#test-cases-for-ionization">Test cases for ionization</a></li>
<li><a class="reference internal" href="#collisions-debugging">Collisions debugging</a></li>
<li><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
</ul>

            <ul>
                <li class="outer">
                    <a href="ionization.html">Ionization</a>
                </li>
                <li class="outer">
                    <a href="radiation_loss.html">Synchrotron-like radiation reaction</a>
                </li>
                <li class="outer">
                    <a href="multiphoton_Breit_Wheeler.html">Multiphoton Breit-Wheeler pair creation</a>
                </li>
                <li class="outer">
                    <a href="particle_merging.html">Particle Merging</a>
                </li>
                <li class="outer">
                    <a href="particle_injector.html">Particle Injector</a>
                </li>
                <li class="outer">
                    <a href="laser_envelope.html">Laser envelope model</a>
                </li>
                <li class="outer">
                    <a href="relativistic_fields_initialization.html">Field initialization for relativistic species</a>
                </li>
                <li class="outer">
                    <a href="azimuthal_modes_decomposition.html">Azimuthal modes decomposition</a>
                </li>
        </ul>
        <hr />
        <ul>
                <li class="outer">
                    <a href="installation.html">Install</a>
                </li>
                <li class="outer">
                    <a href="namelist.html">Write a namelist</a>
                </li>
                <li class="outer">
                    <a href="run.html">Run</a>
                </li>
                <li class="outer">
                    <a href="post-processing.html">Post-process</a>
                </li>
                <li class="outer">
                    <a href="contribute.html">Contribute</a>
                </li>
        </ul>
        <hr />
        <ul>
                <li class="outer">
                    <a href="material.html">Publications</a>
                </li>
                <li class="outer">
                    <a href="partners.html">Partners</a>
                </li>
                <li class="outer">
                    <a href="https://smileipic.github.io/tutorials">Smilei tutorials</a>
                </li>
        </ul>
        <hr />
    </div>

</div>
<div id="hcontainer">
    <div id="nav_positioner">
        <div id="nav">
            <div id="nav_button" onclick="toggleNav()">
                Sections
            </div>
            <div id="nav_list" class="toctree-smilei">
                <div id="nav_title"><a href="#">Binary collisions</a></div>
                <ul>
<li><a class="reference internal" href="#">Binary collisions</a><ul>
<li><a class="reference internal" href="#the-binary-collision-scheme">The binary collision scheme</a></li>
<li><a class="reference internal" href="#test-cases-for-collisions">Test cases for collisions</a></li>
<li><a class="reference internal" href="#collisional-ionization">Collisional ionization</a></li>
<li><a class="reference internal" href="#test-cases-for-ionization">Test cases for ionization</a></li>
<li><a class="reference internal" href="#collisions-debugging">Collisions debugging</a></li>
<li><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
</ul>

            </div>
        </div>
    </div>
    
    <div class="headercolor">
    </div>
    <div class="hpositioner">
        <div class="header">
        <div class="logo">
            <a href="index.html">
                <img class="logo" src="_static/smileiLogo.svg" alt="Logo" />
            </a>
        </div>
        <div class="menu"
            id="menu_Overview"
            
        >
            <div id="menuButton_Overview" class="menuButton"
                 onmouseenter="prepareMenu('menu_Overview')"
                 onmousedown="event.preventDefault()"
            >
                <a href="overview.html">
                    <span>Overview</span>
                </a>
            </div>
            <div class="off" onmouseleave="leaveMenu('menu_Overview',this)">
                <div class="toctree-smilei">
                    <ul>
                        <li class="outer">
                            <a href="licence.html">Licence</a>
                        </li>
                        <li class="outer">
                            <a href="synopsis.html">Synopsis</a>
                        </li>
                        <li class="outer">
                            <a href="highlights.html">Highlights</a>
                        </li>
                        <li class="outer">
                            <a href="releases.html">Releases</a>
                        </li>
        
                    </ul>
                </div>
            </div>
        </div>
        <div class="menu"
            id="menu_Understand"
            style="font-weight:bold"
        >
            <div id="menuButton_Understand" class="menuButton"
                 onmouseenter="prepareMenu('menu_Understand')"
                 onmousedown="event.preventDefault()"
            >
                <a href="understand.html">
                    <span>Understand</span>
                </a>
            </div>
            <div class="off" onmouseleave="leaveMenu('menu_Understand',this)">
                <div class="toctree-smilei">
                    <ul>
                        <li class="outer">
                            <a href="units.html">Units</a>
                        </li>
                        <li class="outer">
                            <a href="algorithms.html">PIC algorithms</a>
                        </li>
                        <li class="outer">
                            <a href="parallelization.html">Parallelization basics</a>
                        </li>
                        <li class="outer">
                            <a href="vectorization.html">Vectorization</a>
                        </li>
                        <li >
                            <a href="#">Binary collisions</a>
                        </li>
                        <li class="outer">
                            <a href="ionization.html">Ionization</a>
                        </li>
                        <li class="outer">
                            <a href="radiation_loss.html">Synchrotron-like radiation reaction</a>
                        </li>
                        <li class="outer">
                            <a href="multiphoton_Breit_Wheeler.html">Multiphoton Breit-Wheeler pair creation</a>
                        </li>
                        <li class="outer">
                            <a href="particle_merging.html">Particle Merging</a>
                        </li>
                        <li class="outer">
                            <a href="particle_injector.html">Particle Injector</a>
                        </li>
                        <li class="outer">
                            <a href="laser_envelope.html">Laser envelope model</a>
                        </li>
                        <li class="outer">
                            <a href="relativistic_fields_initialization.html">Field initialization for relativistic species</a>
                        </li>
                        <li class="outer">
                            <a href="azimuthal_modes_decomposition.html">Azimuthal modes decomposition</a>
                        </li>
        
                    </ul>
                </div>
            </div>
        </div>
        <div class="menu"
            id="menu_Use"
            
        >
            <div id="menuButton_Use" class="menuButton"
                 onmouseenter="prepareMenu('menu_Use')"
                 onmousedown="event.preventDefault()"
            >
                <a href="use.html">
                    <span>Use</span>
                </a>
            </div>
            <div class="off" onmouseleave="leaveMenu('menu_Use',this)">
                <div class="toctree-smilei">
                    <ul>
                        <li class="outer">
                            <a href="installation.html">Install</a>
                        </li>
                        <li class="outer">
                            <a href="namelist.html">Write a namelist</a>
                        </li>
                        <li class="outer">
                            <a href="run.html">Run</a>
                        </li>
                        <li class="outer">
                            <a href="post-processing.html">Post-process</a>
                        </li>
                        <li class="outer">
                            <a href="contribute.html">Contribute</a>
                        </li>
        
                    </ul>
                </div>
            </div>
        </div>
        <div class="last menu"
            id="menu_More"
            
        >
            <div id="menuButton_More" class="menuButton"
                 onmouseenter="prepareMenu('menu_More')"
                 onmousedown="event.preventDefault()"
            >
                <a href="more.html">
                    <span>More</span>
                </a>
            </div>
            <div class="off" onmouseleave="leaveMenu('menu_More',this)">
                <div class="toctree-smilei">
                    <ul>
                        <li class="outer">
                            <a href="material.html">Publications</a>
                        </li>
                        <li class="outer">
                            <a href="partners.html">Partners</a>
                        </li>
                        <li class="outer">
                            <a href="https://smileipic.github.io/tutorials">Smilei tutorials</a>
                        </li>
        
                    </ul>
                </div>
            </div>
        </div>
        
        <script type="text/javascript">
            var es=document.getElementsByClassName("menuButton"), i=0;
            var evt = "ontouchend" in document ? "touchend" : "click";
            for( var i=0; i<es.length; i+=1 ) {
                es[i].addEventListener(evt, function(a){ return function(){toggleMenu(a)};}(es[i].parentNode.id));
            }
        </script>
        
        <div id="searchbox" role="search" style="display:none">
            <form class="search" action="search.html" method="get">
              <input type="text" name="q" placeholder="Search" id="searchinput" />
              <input type="hidden" name="check_keywords" value="yes" />
              <input type="hidden" name="area" value="default" />
            </form>
        </div>
        
        <div id="searchicon" onclick="openSearch()" style="display:block">
            <svg
               xmlns="http://www.w3.org/2000/svg"
               viewBox="0 0 80 120">
              <g transform="translate(0,-932.36216)" >
                <circle
                   r="25" cy="977.51044" cx="38.078663"
                   style="opacity:1;fill:none;stroke:#ffffff;stroke-width:10;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" />
                <rect
                   transform="matrix(0.36717877,0.93015039,-0.93427297,0.35655858,0,0)"
                   rx="4.9996676" ry="7.4995141"
                   y="316.16959" x="947.6142"
                   height="14.117695" width="46.476151"
                   style="opacity:1;fill:#ffffff;fill-opacity:1;stroke:none;" />
                <path
                   d="m 41.383282,962.25996 a 15,15 0 0 1 11.660107,11.6355"
                   style="opacity:1;fill:none;stroke:#ffffff;stroke-width:3;stroke-linecap:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" />
              </g>
            </svg>
        </div>
        <div id="closesearchicon" onclick="closeSearch()" style="display:none">
            <svg
               xmlns="http://www.w3.org/2000/svg"
               viewBox="0 0 80 120">
              <g
                 transform="translate(0,-932.36216)">
                <path
                   d="m 10,962.36216 60,60.00004"
                   style="fill:none;stroke:#ffffff;stroke-width:10;stroke-linecap:round;stroke-linejoin:miter;stroke-opacity:1;stroke-miterlimit:4;stroke-dasharray:none" />
                <path
                   d="M 70,962.36216 10,1022.3622"
                   style="fill:none;stroke:#ffffff;stroke-width:10;stroke-linecap:round;stroke-linejoin:miter;stroke-opacity:1;stroke-miterlimit:4;stroke-dasharray:none" />
              </g>
            </svg>
        </div>
        
        <div id="smallScreenMenuButton" onclick="toggleSmallScreenMenu(event)">
            <svg xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg"
               viewBox="-20 -20 140 140">
              <g  style="fill:#ffffff;stroke:none;">
                <circle cx="15" cy="20" r="5" />
                <circle cx="35" cy="20" r="5" />
                <circle cx="85" cy="20" r="5" />
                <rect width="50" height="10" x="35" y="15" rx="0" ry="0" />
                <circle cx="15" cy="40" r="5" />
                <circle cx="35" cy="40" r="5" />
                <circle cx="85" cy="40" r="5" />
                <rect width="50" height="10" x="35" y="35" rx="0" ry="0" />
                <circle cx="15" cy="60" r="5" />
                <circle cx="35" cy="60" r="5" />
                <circle cx="85" cy="60" r="5" />
                <rect width="50" height="10" x="35" y="55" rx="0" ry="0" />
                <circle cx="15" cy="80" r="5" />
                <circle cx="35" cy="80" r="5" />
                <circle cx="85" cy="80" r="5" />
                <rect width="50" height="10" x="35" y="75" rx="0" ry="0" />
              </g>
            </svg>
        </div>
        
    </div>
    
</div>
</div>

    <div class="document">
    <div class="documentwrapper">
        <div class="body" role="main">
          
  <div class="section" id="binary-collisions">
<h1>Binary collisions<a class="headerlink" href="#binary-collisions" title="Permalink to this headline">¶</a></h1>
<p>Relativistic binary collisions between particles have been implemented in
<strong class="program">Smilei</strong> with the same scheme as the one developed for the
code <strong class="program">Calder</strong>. The following references describe the physics
and numerics of this implementation.</p>
<div class="line-block">
<div class="line"><a class="reference internal" href="#perez2012" id="id1"><span>[Perez2012]</span></a> gives an overview of the technique.</div>
<div class="line"><a class="reference internal" href="#nanbu1997" id="id2"><span>[Nanbu1997]</span></a> and <a class="reference internal" href="#nanbu1998" id="id3"><span>[Nanbu1998]</span></a> give the original technique from which <a class="reference internal" href="#perez2012" id="id4"><span>[Perez2012]</span></a> was developed.</div>
<div class="line"><a class="reference internal" href="#sentoku2008" id="id5"><span>[Sentoku2008]</span></a>, <a class="reference internal" href="#lee1984" id="id6"><span>[Lee1984]</span></a> and <a class="reference internal" href="#frankel1979" id="id7"><span>[Frankel1979]</span></a> provide additional information.</div>
</div>
<p>Please refer to <a class="reference internal" href="namelist.html#collisions"><span class="std std-ref">that doc</span></a> for an explanation of how to add collisions in the namelist file.</p>
<hr class="docutils" />
<div class="section" id="the-binary-collision-scheme">
<h2>The binary collision scheme<a class="headerlink" href="#the-binary-collision-scheme" title="Permalink to this headline">¶</a></h2>
<p>Collisions are calculated at each timestep and for each collision block
given in the input file.</p>
<p>If <em>intra-collisions</em>:</p>
<blockquote>
<div><div class="line-block">
<div class="line">Create one array of indices pointing to all particles of the species group.</div>
<div class="line">Shuffle the array.</div>
<div class="line">Split the array in two halves.</div>
</div>
</div></blockquote>
<p>If <em>inter-collisions</em>:</p>
<blockquote>
<div><div class="line-block">
<div class="line">Create two arrays of indices pointing to all particles of each species group.</div>
<div class="line">Shuffle the largest array. The other array is not shuffled.</div>
<div class="line">=&gt; The two resulting arrays represent pairs of particles (see algorithm in <a class="reference internal" href="#nanbu1998" id="id8"><span>[Nanbu1998]</span></a>).</div>
</div>
</div></blockquote>
<p>Calculate a few intermediate quantities:</p>
<blockquote>
<div><div class="line-block">
<div class="line">Particle density <span class="math notranslate nohighlight">\(n_1\)</span> of group 1.</div>
<div class="line">Particle density <span class="math notranslate nohighlight">\(n_2\)</span>  of group 2.</div>
<div class="line"><em>Crossed</em> particle density <span class="math notranslate nohighlight">\(n_{12}\)</span> (see <a class="reference internal" href="#perez2012" id="id9"><span>[Perez2012]</span></a>).</div>
<div class="line">Other constants.</div>
</div>
</div></blockquote>
<p>For each pair of particles:</p>
<blockquote>
<div><div class="line-block">
<div class="line">Calculate the momenta in the center-of-mass (COM) frame.</div>
<div class="line">Calculate the coulomb log if requested (see <a class="reference internal" href="#perez2012" id="id10"><span>[Perez2012]</span></a>).</div>
<div class="line">Calculate the parameter <span class="math notranslate nohighlight">\(s\)</span> and its correction at low temperature (see <a class="reference internal" href="#perez2012" id="id11"><span>[Perez2012]</span></a>).</div>
<div class="line">Pick the deflection angle (see <a class="reference internal" href="#nanbu1997" id="id12"><span>[Nanbu1997]</span></a>).</div>
<div class="line">Deflect particles in the COM frame and go back to the laboratory frame.</div>
</div>
</div></blockquote>
<p class="rubric">Modification in Smilei</p>
<p>A typo has been introduced in <a class="reference internal" href="#perez2012" id="id13"><span>[Perez2012]</span></a>, Eq. (22), corresponding to the calculation of
the Coulomb Logarithm: the last parenthesis is written as a squared expression,
but should not. This was corrected in <strong class="program">Smilei</strong>.</p>
</div>
<hr class="docutils" />
<div class="section" id="test-cases-for-collisions">
<h2>Test cases for collisions<a class="headerlink" href="#test-cases-for-collisions" title="Permalink to this headline">¶</a></h2>
<p class="rubric">1. Beam relaxation</p>
<p>An electron beam with narrow energy spread enters an ion background with <span class="math notranslate nohighlight">\(T_i=10\)</span> eV.
The ions are of very small mass <span class="math notranslate nohighlight">\(m_i=10 m_e\)</span> to speed-up the calculation.
Only e-i collisions are calculated.
The beam gets strong isotropization =&gt; the average velocity relaxes to zero.</p>
<p>Three figures show the time-evolution of the longitudinal <span class="math notranslate nohighlight">\(\left&lt;v_\|\right&gt;\)</span>
and transverse velocity <span class="math notranslate nohighlight">\(\sqrt{\left&lt;v_\perp^2\right&gt;}\)</span></p>
<ul class="simple">
<li><p><a class="reference internal" href="#beam1"><span class="std std-numref">Fig. 13</span></a> : initial velocity = 0.05, ion charge = 1</p></li>
<li><p><a class="reference internal" href="#beam2"><span class="std std-numref">Fig. 14</span></a> : initial velocity = 0.01, ion charge = 1</p></li>
<li><p><a class="reference internal" href="#beam3"><span class="std std-numref">Fig. 15</span></a> : initial velocity = 0.01, ion charge = 3</p></li>
</ul>
<p>Each of these figures show 3 different blue and red curves which correspond to different
ratios of particle weights: 0.1, 1, and 10.</p>
<div class="figure align-default" id="id23">
<span id="beam1"></span><a class="reference internal image-reference" href="_images/beam_relaxation123.png"><img alt="_images/beam_relaxation123.png" src="_images/beam_relaxation123.png" style="width: 10cm;" /></a>
<p class="caption"><span class="caption-number">Fig. 13 </span><span class="caption-text">Relaxation of an electron beam. Initial velocity = 0.05, ion charge = 1.</span><a class="headerlink" href="#id23" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-default" id="id24">
<span id="beam2"></span><a class="reference internal image-reference" href="_images/beam_relaxation456.png"><img alt="_images/beam_relaxation456.png" src="_images/beam_relaxation456.png" style="width: 10cm;" /></a>
<p class="caption"><span class="caption-number">Fig. 14 </span><span class="caption-text">Relaxation of an electron beam. Initial velocity = 0.01, ion charge = 1.</span><a class="headerlink" href="#id24" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-default" id="id25">
<span id="beam3"></span><a class="reference internal image-reference" href="_images/beam_relaxation789.png"><img alt="_images/beam_relaxation789.png" src="_images/beam_relaxation789.png" style="width: 10cm;" /></a>
<p class="caption"><span class="caption-number">Fig. 15 </span><span class="caption-text">Relaxation of an electron beam. Initial velocity = 0.01, ion charge = 3.</span><a class="headerlink" href="#id25" title="Permalink to this image">¶</a></p>
</div>
<p>The black lines correspond to the theoretical rates taken from the NRL formulary:</p>
<div class="math notranslate nohighlight">
\[\nu_\| = -\left(1+\frac{m_e}{m_i}\right)\nu_0
\quad\textrm{and}\quad
\nu_\perp = 2\;\nu_0
\quad\textrm{where}\quad
\nu_0=\frac{e^4\,Z^{\star 2}\,n_i\,\ln\Lambda } { 4 \pi \epsilon_0^2 \,m_e^2\,v_e^3 }\]</div>
<p>The distribution is quickly non-Maxwellian so that theory is valid only at the beginning.</p>
<p class="rubric">2. Thermalization</p>
<p>A population of electrons has a different temperature from that of the ion population.
Through e-i collisions, the two temperatures become equal.
The ions are of very small mass <span class="math notranslate nohighlight">\(m_i=10 m_e\)</span> to speed-up the calculation.
Three cases are simulated, corresponding to different ratios of weights: 0.2, 1 and 5.
They are plotted in <a class="reference internal" href="#thermalization"><span class="std std-numref">Fig. 16</span></a>.</p>
<div class="figure align-default" id="id26">
<span id="thermalization"></span><a class="reference internal image-reference" href="_images/thermalisation_ei123.png"><img alt="_images/thermalisation_ei123.png" src="_images/thermalisation_ei123.png" style="width: 9cm;" /></a>
<p class="caption"><span class="caption-number">Fig. 16 </span><span class="caption-text">Thermalization between two species.</span><a class="headerlink" href="#id26" title="Permalink to this image">¶</a></p>
</div>
<p>The black lines correspond to the theoretical rates taken from the NRL formulary:</p>
<div class="math notranslate nohighlight">
\[\nu_\epsilon = \frac{2}{3}\sqrt\frac{2}{\pi}
\frac{e^4\,Z^{\star 2} \sqrt{m_em_i}\,n_i\,\ln\Lambda }
{ 4 \pi\epsilon_0^2 \,\left(m_eT_e+m_iT_i\right)^{3/2} }\]</div>
<p class="rubric">3. Temperature isotropization</p>
<p>Electrons have a longitudinal temperature different from their transverse temperature.
They collide only with themselves (intra-collisions) and the anisotropy disappears
as shown in <a class="reference internal" href="#temperature-isotropization"><span class="std std-numref">Fig. 17</span></a>.</p>
<div class="figure align-default" id="id27">
<span id="temperature-isotropization"></span><a class="reference internal image-reference" href="_images/temperature_isotropization1.png"><img alt="_images/temperature_isotropization1.png" src="_images/temperature_isotropization1.png" style="width: 10cm;" /></a>
<p class="caption"><span class="caption-number">Fig. 17 </span><span class="caption-text">Temperature isotropization of an electron population.</span><a class="headerlink" href="#id27" title="Permalink to this image">¶</a></p>
</div>
<p>The black lines correspond to the theoretical rates taken from the NRL formulary:</p>
<div class="math notranslate nohighlight">
\[\nu_T=\frac{e^4 \,n_e\,\ln\Lambda } { 8\pi^{3/2} \epsilon_0^2 \,m_e^{1/2}T_\|^{3/2} }
A^{-2} \left[-3+(3-A)\frac{\rm{arctanh}(\sqrt{A})}{\sqrt{A}}\right]
\quad \rm{where}\quad A=1-\frac{T_\perp}{T_\|}\]</div>
<p class="rubric">4. Maxwellianization</p>
<p>Electrons start with zero temperature along <span class="math notranslate nohighlight">\(y\)</span> and <span class="math notranslate nohighlight">\(z\)</span>.
Their velocity distribution along <span class="math notranslate nohighlight">\(x\)</span> is rectangular.
They collide only with themselves and the rectangle becomes a maxwellian
as shown in <a class="reference internal" href="#maxwellianization"><span class="std std-numref">Fig. 18</span></a>.</p>
<div class="figure align-default" id="id28">
<span id="maxwellianization"></span><a class="reference internal image-reference" href="_images/Maxwellianization1.png"><img alt="_images/Maxwellianization1.png" src="_images/Maxwellianization1.png" style="width: 10cm;" /></a>
<p class="caption"><span class="caption-number">Fig. 18 </span><span class="caption-text">Maxwellianization of an electron population.
Each blue curve is the distribution at a given time.
The red curve is an example of a gaussian function.</span><a class="headerlink" href="#id28" title="Permalink to this image">¶</a></p>
</div>
<p class="rubric">5. Stopping power</p>
<p>Test electrons (very low density) collide with background electrons of density
<span class="math notranslate nohighlight">\(10\,n_c\)</span> and <span class="math notranslate nohighlight">\(T_e=5\)</span> keV.
Depending on their initial velocity, they are slowed down at different rates,
as shown in <a class="reference internal" href="#stoppingpower"><span class="std std-numref">Fig. 19</span></a>.</p>
<div class="figure align-default" id="id29">
<span id="stoppingpower"></span><a class="reference internal image-reference" href="_images/Stopping_power123.png"><img alt="_images/Stopping_power123.png" src="_images/Stopping_power123.png" style="width: 10cm;" /></a>
<p class="caption"><span class="caption-number">Fig. 19 </span><span class="caption-text">Stopping power of test electrons into a background electron population.
Each point is one simulation. The black line is Frankel’s theory <a class="reference internal" href="#frankel1979" id="id14"><span>[Frankel1979]</span></a>.</span><a class="headerlink" href="#id29" title="Permalink to this image">¶</a></p>
</div>
<p class="rubric">6. Conductivity</p>
<p>Solid-density Cu is simulated at different temperatures (e-i equilibrium) with only
e-i collisions. An electric field of <span class="math notranslate nohighlight">\(E=3.2\)</span> GV/m (0.001 in code units) is
applied using two charged layers on each side of the solid Cu.
The electron velocity increases until a limit value <span class="math notranslate nohighlight">\(v_f\)</span>.
The resulting conductivity <span class="math notranslate nohighlight">\(\sigma=en_ev_f/E\)</span> is compared in
<a class="reference internal" href="#conductivity"><span class="std std-numref">Fig. 20</span></a> to the models in <a class="reference internal" href="#lee1984" id="id15"><span>[Lee1984]</span></a> and <a class="reference internal" href="#perez2012" id="id16"><span>[Perez2012]</span></a>.</p>
<div class="figure align-default" id="id30">
<span id="conductivity"></span><a class="reference internal image-reference" href="_images/conductivity.png"><img alt="_images/conductivity.png" src="_images/conductivity.png" style="width: 10cm;" /></a>
<p class="caption"><span class="caption-number">Fig. 20 </span><span class="caption-text">Conductivity of solid-density copper. Each point is one simulation.</span><a class="headerlink" href="#id30" title="Permalink to this image">¶</a></p>
</div>
<hr class="docutils" />
</div>
<div class="section" id="collisional-ionization">
<span id="collionization"></span><h2>Collisional ionization<a class="headerlink" href="#collisional-ionization" title="Permalink to this headline">¶</a></h2>
<p>The binary collisions can also be ionizing if they are <strong>electron-ion</strong> collisions.
The approach is almost the same as that provided in <a class="reference internal" href="#perez2012" id="id17"><span>[Perez2012]</span></a>.</p>
<p>When ionization is requested by setting <code class="docutils literal notranslate"><span class="pre">ionizing=True</span></code>, a few additional operations
are executed:</p>
<ul class="simple">
<li><p>At the beginning of the run, cross-sections are calculated from tabulated binding
energies (available for ions up to atomic number 100). These cross-sections are then
tabulated for each requested ion species.</p></li>
<li><p>Each timestep, the particle density <span class="math notranslate nohighlight">\(n = n_e n_i/n_{ei}\)</span>
(similar to the densities above for collisions) is calculated.</p></li>
<li><p>During each collision, a probability for ionization is computed. If successful,
the ion charge is increased, the incident electron is slowed down, and a new electron
is created.</p></li>
</ul>
<p class="rubric">Warnings</p>
<ul class="simple">
<li><p>This scheme does not account for recombination, which would balance ionization
over long time scales.</p></li>
</ul>
<p class="rubric">Relativistic change of frame</p>
<p>A modification has been added to the theory of <a class="reference internal" href="#perez2012" id="id18"><span>[Perez2012]</span></a> in order to account for the
laboratory frame being different from the ion frame. Considering <span class="math notranslate nohighlight">\(\overrightarrow{p_e}\)</span>
and <span class="math notranslate nohighlight">\(\overrightarrow{p_i}\)</span> the electron and ion momenta in the laboratory frame,
and their associated Lorentz factors <span class="math notranslate nohighlight">\(\gamma_e\)</span> and <span class="math notranslate nohighlight">\(\gamma_i\)</span>, we define
<span class="math notranslate nohighlight">\(\overrightarrow{q_e}=\overrightarrow{p_e}/(m_e c)\)</span> and
<span class="math notranslate nohighlight">\(\overrightarrow{q_i}=\overrightarrow{p_i}/(m_i c)\)</span>.
The Lorentz factor of the electron in the ion frame is
<span class="math notranslate nohighlight">\(\gamma_e^\star=\gamma_e\gamma_i-\overrightarrow{q_e}\cdot\overrightarrow{q_i}\)</span>.
The probability for ionization reads:</p>
<div class="math notranslate nohighlight">
\[P = 1-\exp\left( - v_e \sigma n \Delta t \right) = 1-\exp\left( -V^\star \sigma^\star n \Delta t \right)\]</div>
<p>where <span class="math notranslate nohighlight">\(v_e\)</span> is the electron velocity in the laboratory frame,
<span class="math notranslate nohighlight">\(\sigma\)</span> is the cross-section in the laboratory frame, <span class="math notranslate nohighlight">\(\sigma^\star\)</span>
is the cross-section in the ion frame, and
<span class="math notranslate nohighlight">\(V^\star=c\sqrt{\gamma_e^{\star\,2}-1}/(\gamma_e\gamma_i)\)</span>.</p>
<p>The loss of energy <span class="math notranslate nohighlight">\(m_ec^2 \delta\gamma\)</span> of the incident electron translates into a change in momentum
<span class="math notranslate nohighlight">\({q_e^\star}' = \alpha_e q_e^\star\)</span> in the ion frame, with
<span class="math notranslate nohighlight">\(\alpha_e=\sqrt{(\gamma_e^\star-\delta\gamma)^2-1}/\sqrt{\gamma_e^{\star2}-1}\)</span>.
In the laboratory frame, it becomes
<span class="math notranslate nohighlight">\(\overrightarrow{q_e'}=\alpha_e\overrightarrow{q_e}+((1-\alpha_e)\gamma_e^\star-\delta\gamma)\overrightarrow{q_i}\)</span>.</p>
<p>A similar operation is done for defining the momentum of the new electron in the lab frame.
It is created with energy <span class="math notranslate nohighlight">\(m_ec^2 (\gamma_w-1)\)</span> and its momentum is
<span class="math notranslate nohighlight">\(q_w^\star = \alpha_w q_e^\star\)</span> in the ion frame, with
<span class="math notranslate nohighlight">\(\alpha_w=\sqrt{\gamma_w^2-1}/\sqrt{\gamma_e^{\star 2}-1}\)</span>.
In the laboratory frame, it becomes
<span class="math notranslate nohighlight">\(\overrightarrow{q_w}=\alpha_w\overrightarrow{q_e}+(\gamma_w-\alpha_w\gamma_e^\star)\overrightarrow{q_i}\)</span>.</p>
<p class="rubric">Multiple ionization</p>
<p>A modification has been added to the theory of <a class="reference internal" href="#perez2012" id="id19"><span>[Perez2012]</span></a> in order to account for
multiple ionization in a single timestep. The approach for field ionization
by <a class="reference external" href="http://dx.doi.org/10.1063/1.3559494">Nuter et al</a>
has been adapted to calculate the successive impact ionization probabilities
when an ion is ionized several times in a row.</p>
<p>Writing the probability to not ionize an ion already ionized <span class="math notranslate nohighlight">\(i\)</span> times as
<span class="math notranslate nohighlight">\(\bar{P}^i = \exp\left( -W_i\Delta t\right)\)</span>, and defining
<span class="math notranslate nohighlight">\(R^m_n = (1-W_m/W_n)^{-1}\)</span>, we can calculate the probability to ionize <span class="math notranslate nohighlight">\(k\)</span> times
the ion:</p>
<div class="math notranslate nohighlight">
\[\begin{split}P^i_k = \left\{
\begin{array}{ll}
\bar{P}^i
&amp;
\quad\mathrm{if}\quad k=0
\\
\sum\limits_{p=0}^{k-1} R^{i+k}_{i+p} \left(\bar{P}^{i+k} - \bar{P}^{i+p}\right)
\prod\limits_{j=0,j\ne p}^{k-1} R^{i+p}_{i+j}
&amp;
\quad\mathrm{if}\quad 0&lt;k&lt;k_\mathrm{max}
\\
\sum\limits_{p=0}^{k-1} \left[ 1+R^{i+k}_{i+p}\left(\frac{W_{i+k}}{W_{i+p}}\bar{P}^{i+p} - \bar{P}^{i+k}\right) \right]
\prod\limits_{j=0,j\ne p}^{k-1} R^{i+p}_{i+j}
&amp;
\quad\mathrm{if}\quad k=k_\mathrm{max}
\end{array}
\right.\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(k_\mathrm{max} = Z-Z^\star\)</span>.</p>
<p>The cumulative probability <span class="math notranslate nohighlight">\(F^i_k = \sum_{j=0}^{k} P^i_j\)</span> provides an efficient
way to pick when the ionization stops: we pick a random number <span class="math notranslate nohighlight">\(U\in [0,1]\)</span> and
loop from <span class="math notranslate nohighlight">\(k=0\)</span> to <span class="math notranslate nohighlight">\(k_\mathrm{max}\)</span>. We stop ionizing when <span class="math notranslate nohighlight">\(F^i_k&gt;U\)</span>.</p>
</div>
<hr class="docutils" />
<div class="section" id="test-cases-for-ionization">
<h2>Test cases for ionization<a class="headerlink" href="#test-cases-for-ionization" title="Permalink to this headline">¶</a></h2>
<p class="rubric">1. Ionization rate</p>
<p>A cold plasma of <span class="math notranslate nohighlight">\(\mathrm{Al}^{3+}\)</span> is set with density <span class="math notranslate nohighlight">\(n_e=10^{21} \mathrm{cm}^{-3}\)</span>
and with all electrons drifting at a velocity <span class="math notranslate nohighlight">\(v_e=0.03\,c\)</span>. The charge state of ions
versus time is shown in <a class="reference internal" href="#ionizationrate"><span class="std std-numref">Fig. 21</span></a> where the three dotted curves correspond
to three different weight ratios between electrons and ions.</p>
<div class="figure align-default" id="id31">
<span id="ionizationrate"></span><a class="reference internal image-reference" href="_images/ionization_rate.png"><img alt="_images/ionization_rate.png" src="_images/ionization_rate.png" style="width: 10cm;" /></a>
<p class="caption"><span class="caption-number">Fig. 21 </span><span class="caption-text">Ionization of an aluminium plasma by drifting electrons.</span><a class="headerlink" href="#id31" title="Permalink to this image">¶</a></p>
</div>
<p>The theoretical curve (in black) corresponds to <span class="math notranslate nohighlight">\(1-\exp\left(v_en_e\sigma t\right)\)</span>
where <span class="math notranslate nohighlight">\(\sigma\)</span> is the ionization cross section of <span class="math notranslate nohighlight">\(\mathrm{Al}^{3+}\)</span> at the
right electron energy. The discrepancy at late time is due to the changing velocity
distributions and to the next level starting to ionize.</p>
<p class="rubric">2. Inelastic stopping power</p>
<p>A cold, non-ionized Al plasma is set with density <span class="math notranslate nohighlight">\(n_e=10^{21} \mathrm{cm}^{-3}\)</span>.
Electrons of various initial velocities are slowed down by ionizing collisions and their
energy loss is recorded as a function of time.</p>
<p>A few examples are given in the left graph of <a class="reference internal" href="#ionizationstoppinpower"><span class="std std-numref">Fig. 22</span></a>.
The theoretical curve is obtained from <a class="reference internal" href="#rohrlich1954" id="id20"><span>[Rohrlich1954]</span></a>. Note that this theory does not
work below a certain average ionization energy, in our case <span class="math notranslate nohighlight">\(\sim 200\)</span> eV.</p>
<div class="figure align-default" id="id32">
<span id="ionizationstoppinpower"></span><a class="reference internal image-reference" href="_images/ionization_stopping_power.png"><img alt="_images/ionization_stopping_power.png" src="_images/ionization_stopping_power.png" style="width: 14cm;" /></a>
<p class="caption"><span class="caption-number">Fig. 22 </span><span class="caption-text">Left: ionization slowing down versus time, for electrons injected at various
initial energies into cold Al. Right: corresponding stopping power versus initial
electron energy.</span><a class="headerlink" href="#id32" title="Permalink to this image">¶</a></p>
</div>
<p>In the same figure, the graph on the right-hand-side provides the stopping power value
in the same context, at different electron energies. It is compared to the same theory.</p>
<p class="rubric">3. Multiple ionization</p>
<p>If the timestep is large, multiple ionization can occur, especially with cold high-Z
material and high-energy electrons. The multiple ionization algorithm is not perfect,
as it does not shuffle the particles for each ionization. Thus, good statistical
sampling is reached after several timesteps. To test the potential error,
we ran simulations of electrons at 1 MeV incident on cold atoms. The evolution of the
secondary electron density is monitored versus time in <a class="reference internal" href="#ionizationmultiple"><span class="std std-numref">Fig. 23</span></a>.</p>
<div class="figure align-default" id="id33">
<span id="ionizationmultiple"></span><a class="reference internal image-reference" href="_images/ionization_multiple.png"><img alt="_images/ionization_multiple.png" src="_images/ionization_multiple.png" style="width: 10cm;" /></a>
<p class="caption"><span class="caption-number">Fig. 23 </span><span class="caption-text">Secondary electron density <em>vs</em> time, for cold plasmas traversed by a 1 MeV electron beam.</span><a class="headerlink" href="#id33" title="Permalink to this image">¶</a></p>
</div>
<p>The solid lines correspond to a very-well resolved ionization, whereas the dashed lines
correspond to a large timestep. A difference is visible initially, but decreases
quickly as the statistical sampling increases and as the subsequent ionization
cross-sections decrease.</p>
<p class="rubric">3. Effect of neglecting recombination</p>
<p>As recombination is not accounted for, we can expect excess ionization to occur indefinitely
without being balanced to equilibrium. However, in many cases, the recombination rate
is small and can be neglected over the duration of the simulation. We provide an example
that is relevant to picosecond-scale laser-plasma interaction. Plasmas initially at
a density of 10 times the critical density are given various initial temperatures.
Ionization initially increases while the temperature decreases, until, after a while,
their charge state stagnates (it still increases, but very slowly).
In <a class="reference internal" href="#ionizationrecombination"><span class="std std-numref">Fig. 24</span></a>, these results are compared to a Thomas-Fermi model
from <a class="reference internal" href="#desjarlais2001" id="id21"><span>[Desjarlais2001]</span></a>.</p>
<div class="figure align-default" id="id34">
<span id="ionizationrecombination"></span><a class="reference internal image-reference" href="_images/ionization_recombination.png"><img alt="_images/ionization_recombination.png" src="_images/ionization_recombination.png" style="width: 12cm;" /></a>
<p class="caption"><span class="caption-number">Fig. 24 </span><span class="caption-text">Final charge state of various plasmas at various temperatures.</span><a class="headerlink" href="#id34" title="Permalink to this image">¶</a></p>
</div>
<p>The model does not account for detailed ionization potentials. It provides a rough
approximation, and is particularly questionable for low temperatures or high Z.
We observe that Smilei’s approach for impact ionization provides decent estimates
of the ionization state. Detailed comparison to atomic codes has not been done yet.</p>
</div>
<hr class="docutils" />
<div class="section" id="collisions-debugging">
<h2>Collisions debugging<a class="headerlink" href="#collisions-debugging" title="Permalink to this headline">¶</a></h2>
<p>Using the parameter <code class="docutils literal notranslate"><span class="pre">debug_every</span></code> in a <code class="docutils literal notranslate"><span class="pre">Collisions()</span></code> group (see <a class="reference internal" href="namelist.html#collisions"><span class="std std-ref">Collisions</span></a>)
will create a file with info about these collisions.
These information are stored in the files “Collisions0.h5”, “Collisions1.h5”, etc.</p>
<dl class="simple">
<dt>The <em>hdf5</em> files are structured as follows:</dt><dd><p>One HDF5 file contains several groups called <code class="docutils literal notranslate"><span class="pre">&quot;t********&quot;</span></code> where <code class="docutils literal notranslate"><span class="pre">&quot;********&quot;</span></code>
is the timestep. Each of these groups contains several arrays, which represent
quantities <em>vs.</em> space.</p>
</dd>
</dl>
<p>The available arrays are:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">s</span></code>: defined in <a class="reference internal" href="#perez2012" id="id22"><span>[Perez2012]</span></a>: <span class="math notranslate nohighlight">\(s=N\left&lt;\theta^2\right&gt;\)</span>, where <span class="math notranslate nohighlight">\(N\)</span> is
the typical number of real collisions during a timestep, and
<span class="math notranslate nohighlight">\(\left&lt;\theta^2\right&gt;\)</span> is the average square deviation of individual
real collisions. This quantity somewhat represents the typical amount of angular
deflection accumulated during one timestep.
<strong>It is recommended that</strong> <span class="math notranslate nohighlight">\(s&lt;1\)</span> <strong>in order to have realistic collisions.</strong></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">coulomb_log</span></code>: average Coulomb logarithm.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">debyelength</span></code>: Debye length (not provided if all Coulomb logs are manually defined).</p></li>
</ul>
</div></blockquote>
<p>The arrays have the same dimension as the plasma, but each element of these arrays
is an average over all the collisions occurring in a single <em>patch</em>.</p>
</div>
<hr class="docutils" />
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<dl class="citation">
<dt class="label" id="desjarlais2001"><span class="brackets"><a class="fn-backref" href="#id21">Desjarlais2001</a></span></dt>
<dd><p><a class="reference external" href="http://dx.doi.org/10.1002/1521-3986%28200103%2941%3A2%2F3%3C267%3A%3AAID-CTPP267%3E3.0.CO%3B2-P">M. Desjarlais, Contrib. Plasma Phys. 41, 267 (2001)</a></p>
</dd>
<dt class="label" id="frankel1979"><span class="brackets">Frankel1979</span><span class="fn-backref">(<a href="#id7">1</a>,<a href="#id14">2</a>)</span></dt>
<dd><p><a class="reference external" href="https://doi.org/10.1103/PhysRevA.20.2120">N. E. Frankel, K. C. Hines, and R. L. Dewar, Phys. Rev. A 20, 2120 (1979)</a></p>
</dd>
<dt class="label" id="lee1984"><span class="brackets">Lee1984</span><span class="fn-backref">(<a href="#id6">1</a>,<a href="#id15">2</a>)</span></dt>
<dd><p><a class="reference external" href="http://dx.doi.org/10.1063/1.864744">Y. T. Lee and R. M. More, Phys. Fluids 27, 1273 (1984)</a></p>
</dd>
<dt class="label" id="nanbu1997"><span class="brackets">Nanbu1997</span><span class="fn-backref">(<a href="#id2">1</a>,<a href="#id12">2</a>)</span></dt>
<dd><p><a class="reference external" href="http://dx.doi.org/10.1103/PhysRevE.55.4642">K. Nanbu, Phys. Rev. E 55, 4642 (1997)</a></p>
</dd>
<dt class="label" id="nanbu1998"><span class="brackets">Nanbu1998</span><span class="fn-backref">(<a href="#id3">1</a>,<a href="#id8">2</a>)</span></dt>
<dd><p><a class="reference external" href="http://dx.doi.org/10.1006/jcph.1998.6049">K. Nanbu and S. Yonemura, J. Comput. Phys. 145, 639 (1998)</a></p>
</dd>
<dt class="label" id="perez2012"><span class="brackets">Perez2012</span><span class="fn-backref">(<a href="#id1">1</a>,<a href="#id4">2</a>,<a href="#id9">3</a>,<a href="#id10">4</a>,<a href="#id11">5</a>,<a href="#id13">6</a>,<a href="#id16">7</a>,<a href="#id17">8</a>,<a href="#id18">9</a>,<a href="#id19">10</a>,<a href="#id22">11</a>)</span></dt>
<dd><p><a class="reference external" href="http://dx.doi.org/10.1063/1.4742167">F. Pérez et al., Phys. Plasmas 19, 083104 (2012)</a></p>
</dd>
<dt class="label" id="rohrlich1954"><span class="brackets"><a class="fn-backref" href="#id20">Rohrlich1954</a></span></dt>
<dd><p><a class="reference external" href="http://journals.aps.org/pr/abstract/10.1103/PhysRev.93.38">F. Rohrlich and B. C. Carlson, Phys. Rev. 93, 38 (1954)</a></p>
</dd>
<dt class="label" id="sentoku2008"><span class="brackets"><a class="fn-backref" href="#id5">Sentoku2008</a></span></dt>
<dd><p><a class="reference external" href="http://dx.doi.org/10.1016/j.jcp.2008.03.043">Y. Sentoku and A. J. Kemp, J. Comput. Phys. 227, 6846 (2008)</a></p>
</dd>
</dl>
</div>
</div>


        </div></div>
    </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      <div>
      <a href="site.html">Site index</a>
      </div>
      <div>
        Last updated on Feb 17, 2020
      </div>
      
      <div>
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.1</a>
      </div>
      
    </div>
    
    <script type="text/javascript">
        
        var nav = document.getElementById("nav");
        var nav_list = document.getElementById("nav_list");
        var nav_button = document.getElementById("nav_button");
        var smallScreenMenu = document.getElementById("smallScreenMenu");
        var smallScreenMenuButton = document.getElementById("smallScreenMenuButton");
        var searchicon = document.getElementById("searchicon");
        var searchbox  = document.getElementById("searchbox");
        var searchinput= document.getElementById("searchinput");
        var menus = document.getElementsByClassName("menu");
        for( var i=0; i<menus.length; i++ )
            menus[i].active = false;
        
        
        var ul = nav_list.getElementsByTagName("ul")[0], li;
        var keep_nav = false;
        if( ul ) {
            li = ul.firstElementChild;
            if( li ) {
                if( li.getElementsByTagName("ul").length > 0 ) keep_nav = true;
            }
        }
        if( keep_nav ) {
            li.removeChild( li.firstElementChild );
        } else {
            document.getElementById("nav_positioner").removeChild( document.getElementById("nav") );
        }
        
        function navOff() {
            nav_list.style.display = "none";
            nav_button.className = "";
            nav.style.overflowY = "visible";
        }
        
        function toggleNav() {
            for( var i=0; i<menus.length; i++ )
                menuOff( menus[i] );
            if( nav_list.style.display != "inline-block" ) {
                nav_list.style.display = "inline-block";
                nav_button.className = "pushed";
                nav.style.overflowY = "auto";
            } else {
                navOff();
            }
        }
        
        function toggleSmallScreenMenu(e) {
            e.preventDefault();
            if( smallScreenMenu.className != "on" ) {
                smallScreenMenu.className = "on";
                smallScreenMenuButton.className = "pushed";
            } else {
                smallScreenMenu.className = "off";
                smallScreenMenuButton.className = "";
            }
        }
        
        function prepareMenu(menu_id) {
            var menu = document.getElementById(menu_id);
            menu.timer1 = setTimeout(function(a){ return function(){thisMenuOnly(a)};}(menu_id), 100);
            menu.addEventListener("mouseleave", function(a){ return function(){clearTimeout(a.timer1)};}(menu) );
        }
        
        function leaveMenu(menu_id, source) {
            var menu = document.getElementById(menu_id);
            menu.timer2 = setTimeout(function(a){ return function(){menuOff(a)};}(menu), 1000);
            source.addEventListener("mouseenter", function(a){ return function(){clearTimeout(a.timer2)};}(menu) );
        }
        
        function menuOn( menu ) {
            var divs = menu.getElementsByTagName("div");
            if(nav_list) navOff();
            divs[1].className = "on";
            divs[0].className = "menuButton pushed";
            menu.active = true;
        }
        function menuOff( menu ) {
            var divs = menu.getElementsByTagName("div");
            divs[1].className = "off";
            divs[0].className = "menuButton";
            menu.active = false;
        }
        
        function thisMenuOnly(menu_id) {
            var menu = document.getElementById(menu_id);
            for( var i=0; i<menus.length; i++ )
                if( i!=menu_id )
                    menuOff( menus[i] );
            menuOn( menu );
        }
        
        function toggleMenu(menu_id) {
            var menu = document.getElementById(menu_id);
            if( menu.active ) {
                menuOff( menu );
            } else {
                for( var i=0; i<menus.length; i++ )
                    if( i!=menu_id )
                        menuOff( menus[i] );
                menuOn( menu );
            }
        }
        
        function openSearch() {
            for( var i=0; i<menus.length; i++ ) {
                menuOff( menus[i] );
                menus[i].style.zIndex = "-1";
            }
            searchicon.style.display = "none";
            closesearchicon.style.display = "block";
            searchbox.style.display = "block";
            searchinput.focus();
        }
        
        function closeSearch() {
            searchicon.style.display = "block";
            closesearchicon.style.display = "none";
            searchbox .style.display = "none";
            for( var i=0; i<menus.length; i++ )
                menus[i].style.zIndex = "0";
        }
        
        
        var documentDiv = document.getElementsByClassName("document")[0];
        documentDiv.addEventListener('click', function (event) {
            if(nav_list) navOff();
            for( var i=0; i<menus.length; i++ )
                menuOff( menus[i] );
        });
    </script>
  </body>
</html>